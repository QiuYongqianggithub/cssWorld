层叠上下文的特性 
层叠上下文元素有如下特性。
• 层叠上下文的层叠顺序要比普通元素高（原因后面会说明）。
• 层叠上下文可以阻断元素的混合模式（参见 `http://www.zhangxinxu.com/wordpress/?p=
5155 `的这篇文章的第二部分说明）。
• 层叠上下文可以嵌套，内部层叠上下文及其所有子元素均受制于外部的“层叠上下文”。 
• 每个层叠上下文和兄弟元素独立，也就是说，当进行层叠变化或渲染的时候，只需要
考虑后代元素。
• 每个层叠上下文是自成体系的，当元素发生层叠的时候，整个元素被认为是在父层叠上下文的层叠顺序中。


层叠上下文的创建
在css2.1中：
1．根层叠上下文 
根层叠上下文指的是页面根元素，可以看成是`<html>`元素。因此，页面中所有的元素一
定处于至少一个“层叠结界”中。
2．定位元素与传统层叠上下文 
对于 position 值为 relative/absolute 以及 Firefox/IE 浏览器（不包括 Chrome 浏览
器）下含有 position:fixed 声明的定位元素，当其 z-index 值不是 auto 的时候，会创建
层叠上下文。


在css3中：
（1）元素为 flex 布局元素（父元素 display:flex|inline-flex），同时 z-index
值不是 auto。 
（2）元素的 opacity 值不是 1。
（3）元素的 transform 值不是 none。
（4）元素 mix-blend-mode 值不是 normal。
（5）元素的 filter 值不是 none。
（6）元素的 isolation 值是 isolate。
（7）元素的 will-change 属性值为上面 2～6 的任意一个（如 will-change:opacity、
will-chang:transform 等）。 
（8）元素的-webkit-overflow-scrolling 设为 touch。



一旦普通元素具有了层叠上下文，层叠顺序会提高：
（1）如果层叠上下文元素不依赖 z-index 数值，则其层叠顺序是 z-index:auto，可看
成 z:index:0 级别； 
（2）如果层叠上下文元素依赖 z-index 数值，则其层叠顺序由 z-index 值决定。

所有元素，都通过层叠顺序来判断谁该显示。
层叠顺序规则：
从下到上：
background/border
负z-index
block
float
inline
z-index:0/z-index:auto
正z-index

注：
（1）位于最下面的 background/border 特指层叠上下文元素的边框和背景色。每一个
层叠顺序规则仅适用于当前层叠上下文元素的小世界。
（2）inline 水平盒子指的是包括 inline/inline-block/inline-table 元素的“层
叠顺序”，它们都是同等级别的。
（3）单纯从层叠水平上看，实际上 z-index:0 和 z-index:auto 是可以看成是一样的。注
意这里的措辞—“单纯从层叠水平上看”，实际上，两者在层叠上下文领域有着根本性的差异。

当元素发生层叠的时候，其覆盖关系遵循下面两条准则： 
（1）谁大谁上：当具有明显的层叠水平标识的时候，如生效的 z-index 属性值，在同一
个层叠上下文领域，层叠水平值大的那一个覆盖小的那一个。
（2）后来居上：当元素的层叠水平一致、层叠顺序相同的时候，在 DOM 流中处于后面的
元素会覆盖前面的元素。

不犯二准则：
对于非浮层元素，避免设置 z-index 值，z-index 值没有任何道理需
要超过 2。由于 z-index 不能超过 2，因此，我称其为“不犯二”准则。 
这是一条经验准则，可以有效降低日后遇到 z-index 样式问题的风险。 
先讲一下为什么需要这个准则。
（1）定位元素一旦设置了 z-index 值，就从普通定位元素变成了层叠上下文元素，相互
间的层叠顺序就发生了根本的变化，很容易出现设置了巨大的 z-index 值也无法覆盖其他元
素的问题。
（2）避免 z-index“一山比一山高”的样式混乱问题。此问题多发生在多人协作以及后期
维护的时候。例如，A 小图标定位，习惯性写了个 z-index:9；B 一看，自己原来的实现被覆
盖了，立马写了个 z-index:99；结果比弹框组件层级还高，那还得了，立马弹框组件来一个
z-index:999999；谁知后来，弹框中又要有出错提示效果……显然，最后项目的 z-index
层级管理就是一团糟。
如果真的了解了本章的内











